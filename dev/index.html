<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>ThreadPinning · ThreadPinning.jl</title><script data-outdated-warner src="assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href><img src="assets/logo.png" alt="ThreadPinning.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href>ThreadPinning.jl</a></span></div><form class="docs-search" action="search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li class="is-active"><a class="tocitem" href>ThreadPinning</a><ul class="internal"><li><a class="tocitem" href="#Installation"><span>Installation</span></a></li><li><a class="tocitem" href="#Terminology-in-This-Package"><span>Terminology in This Package</span></a></li><li><a class="tocitem" href="#Noteworthy-Alternatives"><span>Noteworthy Alternatives</span></a></li><li><a class="tocitem" href="#Acknowledgements"><span>Acknowledgements</span></a></li></ul></li><li><input class="collapse-toggle" id="menuitem-2" type="checkbox"/><label class="tocitem" for="menuitem-2"><span class="docs-label">Examples</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="examples/ex_pinning_julia_threads/">Pinning Julia Threads</a></li><li><a class="tocitem" href="examples/ex_affinity/">Respect Process Affinity Mask</a></li><li><a class="tocitem" href="examples/ex_mpi/">MPI and MPI + Threads</a></li><li><a class="tocitem" href="examples/ex_blas/">Autochecking BLAS Thread Settings</a></li><li><a class="tocitem" href="examples/ex_core2core_latency/">Measuring Core-to-Core Latency</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3" type="checkbox"/><label class="tocitem" for="menuitem-3"><span class="docs-label">Explanations</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="explanations/why/">Why Pin Julia Threads?</a></li><li><a class="tocitem" href="explanations/linux/">Why only Linux?</a></li><li><a class="tocitem" href="explanations/blas/">Julia Threads + BLAS Threads</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4" type="checkbox"/><label class="tocitem" for="menuitem-4"><span class="docs-label">References</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="refs/api/">API</a></li><li><a class="tocitem" href="refs/blaslapack/">BLAS/LAPACK</a></li><li><a class="tocitem" href="refs/latency/">Latency</a></li><li><a class="tocitem" href="refs/libX/">LibX</a></li><li><a class="tocitem" href="refs/likwidpin/">Likwid-Pin</a></li><li><a class="tocitem" href="refs/prefs/">Preferences</a></li><li><a class="tocitem" href="refs/utility/">Utility</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>ThreadPinning</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>ThreadPinning</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/carstenbauer/ThreadPinning.jl/blob/main/docs/src/index.md#" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="ThreadPinning.jl"><a class="docs-heading-anchor" href="#ThreadPinning.jl">ThreadPinning.jl</a><a id="ThreadPinning.jl-1"></a><a class="docs-heading-anchor-permalink" href="#ThreadPinning.jl" title="Permalink"></a></h1><p><a href="https://github.com/carstenbauer/ThreadPinning.jl/">ThreadPinning.jl</a> allows you to pin Julia threads to specific CPU-threads (i.e. &quot;hardware threads&quot; or, equivalently, &quot;CPU processors&quot;) via functions, environment variables, or <a href="https://github.com/JuliaPackaging/Preferences.jl">Julia preferences</a>. Especially for applications running on HPC clusters, this is often absolutely crucial to achieve optimal performance and/or obtain reliable benchmarks (see <a href="explanations/why/#why">Why pin Julia threads?</a>).</p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>Be aware that Julia implements <strong>task-based multithreading</strong>: <code>M</code> user tasks get scheduled onto <code>N</code> Julia threads. While this package allows you to pin Julia threads to CPU-threads,  it is generally not safe to assume that a computation (started with <code>Threads.@spawn</code> or <code>Threads.@threads</code>) will run on or even stay on a certain Julia thread (see <a href="https://discourse.julialang.org/t/julia-1-7-says-it-can-switch-the-thread-your-task-is-on-how-often-does-that-happen-and-how-can-it-be-disabled/75373/4?u=carstenbauer">this discourse post</a> for more information). If you want this guarantee, you can use our <a href="refs/utility/#ThreadPinning.@tspawnat-Tuple{Any, Any}"><code>@tspawnat</code></a> macro instead.</p></div></div><h2 id="Installation"><a class="docs-heading-anchor" href="#Installation">Installation</a><a id="Installation-1"></a><a class="docs-heading-anchor-permalink" href="#Installation" title="Permalink"></a></h2><p><strong>Note: Only Linux is supported!</strong></p><p>The package is registered. Hence, you can simply use</p><pre><code class="nohighlight hljs">] add ThreadPinning</code></pre><p>to add the package to your Julia environment.</p><h3 id="Prerequisites"><a class="docs-heading-anchor" href="#Prerequisites">Prerequisites</a><a id="Prerequisites-1"></a><a class="docs-heading-anchor-permalink" href="#Prerequisites" title="Permalink"></a></h3><p>To gather information about the hardware topology of the system (e.g. sockets and memory domains), ThreadPinning.jl uses <a href="https://man7.org/linux/man-pages/man1/lscpu.1.html"><code>lscpu</code></a>. The latter must therefore be available (i.e. be on <code>PATH</code>), which should automatically be the case on virtually all linux systems.</p><p>In the unlikely case that <code>lscpu</code> isn&#39;t already installed on your system, here are a few ways to get it</p><ul><li>install <code>util-linux</code> via your system&#39;s package manager or manually from <a href="https://mirrors.edge.kernel.org/pub/linux/utils/util-linux/">here</a></li><li>download the same as a Julia artifact: <a href="https://github.com/JuliaBinaryWrappers/util_linux_jll.jl">util_linux_jll.jl</a></li></ul><h3 id="Autoupdate-setting"><a class="docs-heading-anchor" href="#Autoupdate-setting">Autoupdate setting</a><a id="Autoupdate-setting-1"></a><a class="docs-heading-anchor-permalink" href="#Autoupdate-setting" title="Permalink"></a></h3><p>By default, ThreadPinning.jl queries the system topology using <code>lscpu</code> on startup (i.e. at runtime). This is quite costly but is unfortunately necessary since you might have precompiled the package on one machine and use it from another (think e.g. login and compute nodes of a HPC cluster). However, you can tell ThreadPinning.jl to permanently skip this autoupdate at runtime and to always use the system topology that was present at compile time (i.e. when precompiling the package). This is perfectly save if you don&#39;t use the same Julia depot on different machines, in particular if you&#39;re a &quot;standard user&quot; that uses Julia on a desktop computer or laptop, and can reduce the package load time significantly. To do so, simply call <code>ThreadPinning.Prefs.set_autoupdate(false)</code>.</p><h2 id="Terminology-in-This-Package"><a class="docs-heading-anchor" href="#Terminology-in-This-Package">Terminology in This Package</a><a id="Terminology-in-This-Package-1"></a><a class="docs-heading-anchor-permalink" href="#Terminology-in-This-Package" title="Permalink"></a></h2><ul><li><strong>CPU</strong>: Chip that sits in a socket and (almost always) hosts multiple <strong>CPU-cores</strong>.</li><li><strong>CPU-cores</strong>: Physical processor cores of the <strong>CPU</strong>.</li><li><strong>CPU-threads</strong>: Hardware threads (a.k.a. &quot;virtual cores&quot;) within the <strong>CPU-cores</strong>.</li><li><strong>CPU ID</strong>: Unique ID that identifies a specific <strong>CPU-thread</strong>. (This is somewhat inconsistent but has been chosen for brevity and backwards-compatibility reasons.)</li></ul><p>If the system supports <a href="https://en.wikipedia.org/wiki/Simultaneous_multithreading">SMT</a> (&quot;hyperthreading&quot;), there are more CPU-threads than CPU-cores (most commonly a factor of two more). Independent of the CPU vendor, we refer to all but the <em>first</em> CPU-threads in a core as <strong>hyperthreads</strong> (order is taken from <code>lscpu</code>). The latter are highlighted differently in output, see <a href="refs/api/#ThreadPinning.threadinfo"><code>threadinfo()</code></a>.</p><h2 id="Noteworthy-Alternatives"><a class="docs-heading-anchor" href="#Noteworthy-Alternatives">Noteworthy Alternatives</a><a id="Noteworthy-Alternatives-1"></a><a class="docs-heading-anchor-permalink" href="#Noteworthy-Alternatives" title="Permalink"></a></h2><ul><li>Simply setting <a href="https://docs.julialang.org/en/v1/manual/environment-variables/#JULIA_EXCLUSIVE"><code>JULIA_EXCLUSIVE=1</code></a> will pin Julia threads to CPU-threads in &quot;physical order&quot; (i.e. as specified by <code>lscpu</code>), which might or might not include hyperthreads.</li><li><a href="https://juliaperf.github.io/LIKWID.jl/dev/examples/dynamic_pinning/"><code>pinthreads</code></a> or <code>likwid-pin</code> (CLI tool) from <a href="https://github.com/JuliaPerf/LIKWID.jl">LIKWID.jl</a></li><li><a href="https://discourse.julialang.org/t/thread-affinitization-pinning-julia-threads-to-cores/58069/5">This discourse thread</a> discusses issues with alternatives like <code>numactl</code></li></ul><h2 id="Acknowledgements"><a class="docs-heading-anchor" href="#Acknowledgements">Acknowledgements</a><a id="Acknowledgements-1"></a><a class="docs-heading-anchor-permalink" href="#Acknowledgements" title="Permalink"></a></h2><ul><li>CI infrastructure is provided by the <a href="https://pc2.uni-paderborn.de/">Paderborn Center for Parallel Computing (PC²)</a></li></ul></article><nav class="docs-footer"><a class="docs-footer-nextpage" href="examples/ex_pinning_julia_threads/">Pinning Julia Threads »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.25 on <span class="colophon-date" title="Monday 24 July 2023 21:50">Monday 24 July 2023</span>. Using Julia version 1.9.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
