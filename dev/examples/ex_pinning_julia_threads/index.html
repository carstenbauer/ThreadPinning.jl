<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Pinning Julia Threads · ThreadPinning.jl</title><meta name="title" content="Pinning Julia Threads · ThreadPinning.jl"/><meta property="og:title" content="Pinning Julia Threads · ThreadPinning.jl"/><meta property="twitter:title" content="Pinning Julia Threads · ThreadPinning.jl"/><meta name="description" content="Documentation for ThreadPinning.jl."/><meta property="og:description" content="Documentation for ThreadPinning.jl."/><meta property="twitter:description" content="Documentation for ThreadPinning.jl."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="ThreadPinning.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">ThreadPinning.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">ThreadPinning</a></li><li><input class="collapse-toggle" id="menuitem-2" type="checkbox" checked/><label class="tocitem" for="menuitem-2"><span class="docs-label">Examples</span><i class="docs-chevron"></i></label><ul class="collapsed"><li class="is-active"><a class="tocitem" href>Pinning Julia Threads</a><ul class="internal"><li><a class="tocitem" href="#Typical-usage"><span>Typical usage</span></a></li><li><a class="tocitem" href="#envvars"><span>Pinning via environment variables</span></a></li><li><a class="tocitem" href="#prefs"><span>Pinning via preferences</span></a></li><li><a class="tocitem" href="#Default-pinning-(for-packages)"><span>Default pinning (for packages)</span></a></li><li><a class="tocitem" href="#Unpinning"><span>Unpinning</span></a></li><li><a class="tocitem" href="#likwid-pin-compatible-input"><span><code>likwid-pin</code>-compatible input</span></a></li></ul></li><li><a class="tocitem" href="../ex_affinity/">Respect Process Affinity Mask</a></li><li><a class="tocitem" href="../ex_mpi/">MPI and MPI + Threads</a></li><li><a class="tocitem" href="../ex_blas/">Autochecking BLAS Thread Settings</a></li><li><a class="tocitem" href="../ex_core2core_latency/">Measuring Core-to-Core Latency</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3" type="checkbox"/><label class="tocitem" for="menuitem-3"><span class="docs-label">Explanations</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../explanations/why/">Why Pin Julia Threads?</a></li><li><a class="tocitem" href="../../explanations/linux/">Why only Linux?</a></li><li><a class="tocitem" href="../../explanations/blas/">Julia Threads + BLAS Threads</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4" type="checkbox"/><label class="tocitem" for="menuitem-4"><span class="docs-label">References</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../refs/api/">API</a></li><li><a class="tocitem" href="../../refs/blaslapack/">BLAS/LAPACK</a></li><li><a class="tocitem" href="../../refs/latency/">Latency</a></li><li><a class="tocitem" href="../../refs/libX/">LibX</a></li><li><a class="tocitem" href="../../refs/likwidpin/">Likwid-Pin</a></li><li><a class="tocitem" href="../../refs/prefs/">Preferences</a></li><li><a class="tocitem" href="../../refs/utility/">Utility</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href>Pinning Julia Threads</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Pinning Julia Threads</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/carstenbauer/ThreadPinning.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/carstenbauer/ThreadPinning.jl/blob/main/docs/src/examples/ex_pinning_julia_threads.md#" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Pinning-Julia-Threads"><a class="docs-heading-anchor" href="#Pinning-Julia-Threads">Pinning Julia Threads</a><a id="Pinning-Julia-Threads-1"></a><a class="docs-heading-anchor-permalink" href="#Pinning-Julia-Threads" title="Permalink"></a></h1><p>The most important functions are <a href="../../refs/api/#ThreadPinning.pinthreads"><code>pinthreads</code></a> and <a href="../../refs/api/#ThreadPinning.threadinfo"><code>threadinfo</code></a>. The former allows you to pin threads. The latter visualizes the current thread-processor mapping and the system topology. Please check out the comprehensive documentation of these functions for detailed information. </p><h2 id="Typical-usage"><a class="docs-heading-anchor" href="#Typical-usage">Typical usage</a><a id="Typical-usage-1"></a><a class="docs-heading-anchor-permalink" href="#Typical-usage" title="Permalink"></a></h2><h3 id="pinthreads"><a class="docs-heading-anchor" href="#pinthreads"><code>pinthreads</code></a><a id="pinthreads-1"></a><a class="docs-heading-anchor-permalink" href="#pinthreads" title="Permalink"></a></h3><p>Pinning your threads is as simple as putting the following at the top of your Julia code:</p><pre><code class="language-julia hljs">using ThreadPinning
pinthreads(:cores)</code></pre><p>This will successively pin all Julia threads to CPU-cores in logical order, avoiding hyperthreads if possible. Of course, you can replace <code>:cores</code> by all the options supported by <a href="../../refs/api/#ThreadPinning.pinthreads"><code>pinthreads</code></a>. Conceptually, there are three different formats to specify your desired thread-processor mapping:</p><ol><li>explicit lists of CPU IDs (e.g. <code>0:3</code> or <code>[0,12,4]</code>),</li><li>predefined symbols (e.g. <code>:cores</code> or <code>:sockets</code>),</li><li>logical specification of domains via helper functions (e.g. <code>node</code> and <code>socket</code>).</li></ol><p>For example, instead of <code>pinthreads(:cores)</code> above, you could write <code>pinthreads(1:2:10)</code> or <code>pinthreads(socket(1,1:3), numa(2,2:5))</code>. Again, see <a href="../../refs/api/#ThreadPinning.pinthreads"><code>pinthreads</code></a> for more information.</p><h3 id="threadinfo"><a class="docs-heading-anchor" href="#threadinfo"><code>threadinfo</code></a><a id="threadinfo-1"></a><a class="docs-heading-anchor-permalink" href="#threadinfo" title="Permalink"></a></h3><p>To check and visualize the current pinning you can use <a href="../../refs/api/#ThreadPinning.threadinfo"><code>threadinfo</code></a> to get something like this.</p><p><img src="../threadinfo_ht_long.png" alt="threadinfo_ht_long.png"/></p><p>As you can see, this image is taken on a dual-socket system (indicated by the two <code>| .... |</code> sections) where each CPU has 20 CPU-cores and Julia has been started with 40 threads. Hyperthreading is enabled - the greyed out numbers indicate hyperthreads/SMT-threads - with two CPU-threads per core.</p><p>Note that <a href="../../refs/api/#ThreadPinning.threadinfo"><code>threadinfo</code></a> has a few keyword arguments that let you change or tune the output. The most important ones are probably <code>groupby</code> and <code>color</code>. The former allows you to switch from socket to, say, NUMA/memory domain visualization (<code>groupby=:numa</code>). The latter allows you to switch to non-colored output (see below).</p><pre><code class="language-julia hljs">julia&gt; using ThreadPinning

julia&gt; threadinfo(; color=false)

| 0,1,_,3,4,_,_,7,8,_,10,_,_,_,_,_,
  16,17,_,_,40,_,42,_,_,_,_,47,48,49,50,51,
  _,_,54,_,_,57,58,_ |
| _,21,22,23,_,_,_,_,28,29,30,_,32,33,_,35,
  _,_,38,39,60,61,62,63,64,65,_,_,68,_,_,_,
  72,73,74,_,_,_,_,_ |

# = Julia thread, # = HT, # = Julia thread on HT, | = Socket seperator

Julia threads: 40
├ Occupied CPU-threads: 40
└ Mapping (Thread =&gt; CPUID): 1 =&gt; 63, 2 =&gt; 64, 3 =&gt; 17, 4 =&gt; 68, 5 =&gt; 4, ...


julia&gt; pinthreads(:cores)

julia&gt; threadinfo(; color=false)

| 0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,
  16,17,18,19,_,_,_,_,_,_,_,_,_,_,_,_,
  _,_,_,_,_,_,_,_ |
| 20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,
  36,37,38,39,_,_,_,_,_,_,_,_,_,_,_,_,
  _,_,_,_,_,_,_,_ |

# = Julia thread, # = HT, # = Julia thread on HT, | = Socket seperator

Julia threads: 40
├ Occupied CPU-threads: 40
└ Mapping (Thread =&gt; CPUID): 1 =&gt; 0, 2 =&gt; 1, 3 =&gt; 2, 4 =&gt; 3, 5 =&gt; 4, ...


julia&gt; pinthreads(:cputhreads)

julia&gt; threadinfo(; color=false)

| 0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,
  16,17,18,19,40,41,42,43,44,45,46,47,48,49,50,51,
  52,53,54,55,56,57,58,59 |
| _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,
  _,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,
  _,_,_,_,_,_,_,_ |

# = Julia thread, # = HT, # = Julia thread on HT, | = Socket seperator

Julia threads: 40
├ Occupied CPU-threads: 40
└ Mapping (Thread =&gt; CPUID): 1 =&gt; 0, 2 =&gt; 40, 3 =&gt; 1, 4 =&gt; 41, 5 =&gt; 2, ...</code></pre><h2 id="envvars"><a class="docs-heading-anchor" href="#envvars">Pinning via environment variables</a><a id="envvars-1"></a><a class="docs-heading-anchor-permalink" href="#envvars" title="Permalink"></a></h2><p>Sometimes it can be useful to specify a desired thread-processor mapping before starting Julia, that is, without using <code>pinthreads</code> explicitly in your Julia code. A Julia-built-in example for this is <a href="https://docs.julialang.org/en/v1/manual/environment-variables/#JULIA_EXCLUSIVE"><code>JULIA_EXCLUSIVE=1</code></a>. Similarly, ThreadPinning.jl offers pinning threads via environment variables. In this case, Julia Threads will get pinned during the initialization of the ThreadPinning package, i.e. when running <code>using ThreadPinning</code>. Note, though, that explicit <code>pinthreads</code> statements take precedence over these environment variables.</p><p>Concretely, the supported environment variables are</p><ul><li><code>JULIA_PIN</code>: Can be set to any <strong>symbol</strong> supported by <a href="../../refs/api/#ThreadPinning.pinthreads"><code>pinthreads</code></a> (e.g. <code>JULIA_PIN=cores</code>). Capitalization doesn&#39;t matter.</li><li><code>JULIA_LIKWID_PIN</code>: Can be set to any string supported by <a href="../../refs/likwidpin/#ThreadPinning.pinthreads_likwidpin-Tuple{AbstractString}"><code>pinthreads_likwidpin</code></a> (e.g. <code>JULIA_LIKWID_PIN=S0:1-3@S1:4,5,6</code>). Capitalization <strong>does</strong> matter.</li></ul><h2 id="prefs"><a class="docs-heading-anchor" href="#prefs">Pinning via preferences</a><a id="prefs-1"></a><a class="docs-heading-anchor-permalink" href="#prefs" title="Permalink"></a></h2><p>To specify a certain pinning pattern more permanently, e.g., on a per-project basis, you can use <a href="https://github.com/JuliaPackaging/Preferences.jl">preferences</a>. ThreadPinning.jl provides the relevant functionality in the <a href="../../refs/prefs/#Preferences"><code>ThreadPinning.Prefs</code> module</a>. Note that environment variables and explicit <code>pinthreads</code> statements take precedence over these preferences.</p><h2 id="Default-pinning-(for-packages)"><a class="docs-heading-anchor" href="#Default-pinning-(for-packages)">Default pinning (for packages)</a><a id="Default-pinning-(for-packages)-1"></a><a class="docs-heading-anchor-permalink" href="#Default-pinning-(for-packages)" title="Permalink"></a></h2><p>If you&#39;re developing a package you may want to provide a reasonable default pinning. If you would naively use <code>pinthreads</code> for this, you would enforce a certain pinning irrespective of what the user might have specified manually. This is because <code>pinthreads</code> has the highest precedence. To lower the latter you can set <code>force=false</code> in your <code>pinthreads</code> call, e.g. <code>pinthreads(:cores; force=false)</code>. This way, a user can overwrite your default pinning (<code>:cores</code> in this example) by using <a href="#envvars">environment variables</a>, <a href="#prefs">preferences</a>, or calling <code>pinthreads</code> manually before running your package code.</p><h2 id="Unpinning"><a class="docs-heading-anchor" href="#Unpinning">Unpinning</a><a id="Unpinning-1"></a><a class="docs-heading-anchor-permalink" href="#Unpinning" title="Permalink"></a></h2><p>We provide functions <a href="../../refs/api/#ThreadPinning.unpinthread-Tuple{Integer}"><code>unpinthread(threadid)</code></a> and <a href="../../refs/api/#ThreadPinning.unpinthreads-Tuple{}"><code>unpinthreads()</code></a> to unpin a specific or all Julia threads, respectively. This is realized by setting the thread affinity mask to all ones. While technically not really unpinning threads, you might also want to consider using <code>pinthreads(:random)</code> for &quot;fake unpinning&quot; in benchmarks as it does randomize the thread placing but keeps it fixed to reduce measurement fluctuations.</p><h2 id="likwid-pin-compatible-input"><a class="docs-heading-anchor" href="#likwid-pin-compatible-input"><code>likwid-pin</code>-compatible input</a><a id="likwid-pin-compatible-input-1"></a><a class="docs-heading-anchor-permalink" href="#likwid-pin-compatible-input" title="Permalink"></a></h2><p>Separate from <a href="../../refs/api/#ThreadPinning.pinthreads"><code>pinthreads</code></a>, used and described above, we offer <a href="../../refs/likwidpin/#ThreadPinning.pinthreads_likwidpin-Tuple{AbstractString}"><code>pinthreads_likwidpin</code></a> which, ideally, should handle all inputs that are supported by the <code>-c</code> option of <a href="https://github.com/RRZE-HPC/likwid/wiki/Likwid-Pin"><code>likwid-pin</code></a> (e.g. <code>S0:1-3@S1:2,4,5</code> or <code>E:N:4:2:4</code>). If you encounter an input that doesn&#39;t work as expected, please file an issue.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../">« ThreadPinning</a><a class="docs-footer-nextpage" href="../ex_affinity/">Respect Process Affinity Mask »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="auto">Automatic (OS)</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.1.2 on <span class="colophon-date" title="Tuesday 28 November 2023 18:29">Tuesday 28 November 2023</span>. Using Julia version 1.9.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
